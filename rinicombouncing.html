<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DVD Bounce (Tinted)</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      overflow: hidden;
      background: black;
    }
    canvas { display: block; }
  </style>
</head>
<body>
  <canvas id="c"></canvas>

  <script>
    const canvas = document.getElementById("c");
    const ctx = canvas.getContext("2d");

    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener("resize", resize);
    resize();

    const img = new Image();
    img.src = "res/local/rinicom-logo.webp";

    const colors = [
      "#8B5CF6", // purple
      "#22C55E", // green
      "#3B82F6", // blue
      "#F97316", // orange
      "#EF4444", // red
      "#06B6D4", // cyan
      "#EC4899", // pink
      "#EAB308", // yellow
    ];

    let lastColor = null;
    function pickColor() {
      let c;
      do {
        c = colors[Math.floor(Math.random() * colors.length)];
      } while (c === lastColor);
      lastColor = c;
      return c;
    }

    // SETTINGS
    const targetW = 300;
    const insetX = 25; // left/right
    const insetY = 15; // top/bottom

    // Motion (speed = 2)
    let vx = -2, vy = -2; // start moving up-left to force corner hit immediately

    let logoW = targetW;
    let logoH = targetW;

    // Start position will be set after image loads
    let x = 0, y = 0;

    // Color state
    let currentColor = pickColor();
    let rainbowMode = false;
    let rainbowHue = 0;

    function hsvToHex(h, s, v) {
      const c = v * s;
      const hp = (h % 360) / 60;
      const x = c * (1 - Math.abs((hp % 2) - 1));
      let r1 = 0, g1 = 0, b1 = 0;

      if (0 <= hp && hp < 1) [r1, g1, b1] = [c, x, 0];
      else if (1 <= hp && hp < 2) [r1, g1, b1] = [x, c, 0];
      else if (2 <= hp && hp < 3) [r1, g1, b1] = [0, c, x];
      else if (3 <= hp && hp < 4) [r1, g1, b1] = [0, x, c];
      else if (4 <= hp && hp < 5) [r1, g1, b1] = [x, 0, c];
      else if (5 <= hp && hp < 6) [r1, g1, b1] = [c, 0, x];

      const m = v - c;
      const r = Math.round((r1 + m) * 255);
      const g = Math.round((g1 + m) * 255);
      const b = Math.round((b1 + m) * 255);

      return "#" + [r, g, b].map(n => n.toString(16).padStart(2, "0")).join("");
    }

    function rainbowColor() {
      rainbowHue = (rainbowHue + 2) % 360;
      return hsvToHex(rainbowHue, 1, 1);
    }

    function drawTinted(image, x, y, w, h, color) {
      ctx.drawImage(image, x, y, w, h);

      ctx.globalCompositeOperation = "source-in";
      ctx.fillStyle = color;
      ctx.fillRect(x, y, w, h);

      ctx.globalCompositeOperation = "source-over";
    }

    function animate() {
      const W = canvas.width;
      const H = canvas.height;

      ctx.clearRect(0, 0, W, H);

      x += vx;
      y += vy;

      let hitX = false;
      let hitY = false;

      // left/right
      if (x + insetX <= 0) {
        x = -insetX;
        vx *= -1;
        hitX = true;
      } else if (x + logoW - insetX >= W) {
        x = W - (logoW - insetX);
        vx *= -1;
        hitX = true;
      }

      // top/bottom
      if (y + insetY <= 0) {
        y = -insetY;
        vy *= -1;
        hitY = true;
      } else if (y + logoH - insetY >= H) {
        y = H - (logoH - insetY);
        vy *= -1;
        hitY = true;
      }

      const bounced = hitX || hitY;
      const cornerHit = hitX && hitY;

      // Color logic
      if (cornerHit) {
        rainbowMode = true;
      } else if (rainbowMode && bounced) {
        rainbowMode = false;
        currentColor = pickColor();
      } else if (!rainbowMode && bounced) {
        currentColor = pickColor();
      }

      const colorToUse = rainbowMode ? rainbowColor() : currentColor;
      drawTinted(img, x, y, logoW, logoH, colorToUse);

      requestAnimationFrame(animate);
    }

    img.onload = () => {
      // keep aspect ratio
      const aspect = img.naturalHeight / img.naturalWidth;
      logoW = targetW;
      logoH = Math.round(targetW * aspect);

      // force a perfect corner hit immediately (top-left)
      x = -insetX;
      y = -insetY;

      requestAnimationFrame(animate);
    };
  </script>
</body>
</html>
